import hashlib
import sys
import cgitb
import os
import glob

filename = sys.argv[1]
# filename = 'images/file.webp'
hasher = hashlib.md5()
with open(filename,'rb') as open_file:
    content = open_file.read()
    hasher.update(content)
hash1 = hasher.hexdigest()
#print(hash1)

list_of_files = glob.glob('uploads/*')
#print(list_of_files)

list1 = []

hasher2 = hashlib.md5()
# for filename2 in list_of_files:
#     with open(filename2, 'rb') as open_file2:
#         content2 = open_file2.read()
#         hasher2.update(content2)
#         hash2 = hasher2.hexdigest()
#         list.append(hash2)
#     print(hash2)

for filename2 in list_of_files:
    with open(filename2, 'rb') as open_file2:
        content2 = open_file2.read()        
        hash2 = hashlib.md5(content2).hexdigest()
        list1.append(hash2)
#    print(hash2)

# print(list)
for line in list1:
    if hash1 in line:
        print("already exists")
    

# def check_if_file_exist(filename2, hash12):    
#     for filename2 in list_of_files:
#         with open(filename2, 'rb') as open_file2:
#             content2 = open_file2.read()
#             hasher.update(content2)
#         hash2 = hasher.hexdigest()
#         print(hash2)
#         for line in filename2:
#             if hash2 in line:
#                 return True
#     return False
        

# if check_if_file_exist(list_of_files, hash1):
#     print("file already exist")
# else:
#     print("file uploaded")
