<?php 
session_start();
session_regenerate_id();
$inactive = 600;

if (isset($_SESSION['timeout'])) {
    $sessionTTL = time() - $_SESSION['timeout'];
    if ($sessionTTL > $inactive) {
        session_destroy();
        header("location: login.php");
    }
}

if (!isset($_SESSION['username']))
{
    header("Location:login.php");
}

$con=mysqli_connect("localhost","root","","malware_detection");

$id=isset($_POST["id"]);
$file_name=isset($_POST["file_name"]);
$md5=isset($_POST["md5"]);
$timestamp=isset($_POST["timestamp"]);
$malware=isset($_POST["malware"]);

    $query=$con->prepare("Select id, file_name, md5, timestamp, malware from history");
    $query->execute();
    $query->store_result();
    $query->bind_result($id, $file_name, $md5, $timestamp, $malware);
    if($query->num_rows === 0) exit('No rows');
    echo "<br><br><br><br><h2>List of files</h2><br>";
    echo "<table border=1>";
    echo "<tr><td>ID</td><td>File Name</td><td>
    MD5</td><td>Timestamp</td><td>Malware Present?
    </td></tr>";
    while($query->fetch()){
        echo "<tr><td>" . $id . "</td><td>" . $file_name . "</td><td>" .
            $md5 . "</td><td>" . $timestamp . "</td><td>" . $malware .
            "</td></tr>";
    }
    echo "</table>";    

$con->close();
?>
<html>
<head>
	<style>
	*
        {
        	margin: 0px;
        	padding: 0px;
        }
        .navbar 
        {
        background-color: #000000;
        position: fixed; /* Set the navbar to fixed position */
        width: 100%;
        top: 0;
        left:0;
        z-index: 999;
        
        }
      
        /* Links inside the navbar */
        .navbar a 
        {
        float: left;
        display: block;
        color: black;
        text-align: center;
        font-size: 25px;
        padding: 15px 30px;
        text-decoration: none;
        color: ffffff;
        }
      
        .navbar a:hover {
        background: #ddd;
        color: black;
        }
    
        .navbar .profile{
          float: right;
        }
        
        .navbar .file_upload{
          float: right;
        }
        /* Main content */
        .main {
        margin-top: 30px; /* Add a top margin to avoid content overlay */
        }
        
        
        
        .input-group
        {
            margin: 10px 0px 10px 0px;
        }
        
        .input-group label
        {
            display: block;
            text-align: left;
            margin: 3px;
        }
        
        .input-group input
        {
            height: 30px;
            width: 93%;
            padding: 5px 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid gray;
        }
        
        .btn
        {
            padding: 10px;
            font-size: 15px;
            color:white;
            background: #5F9EA0;
            border: none;
            border-radius: 5px;
        }
        .md-form
        {   
            padding-top: 70px
        }
        
    </style>
</head>
<br>
<body style= "background: #708090">
<div class="navbar">
    	<a href="index.php">Home</a>
    	
    	<div class="profile">
        	<a href="profile.php">Profile</a>
    	</div>
  
    	<?php if (isset($_SESSION['success'])): ?>
			<div class="error success"></div>
				<h3>
					<?php 
					   echo $_SESSION['success'];
					   unset($_SESSION['success']);
					?>
				</h3>
		<?php endif ?>
		
		<?php if (isset($_SESSION["username"])): ?>
			<p><a>Welcome <strong><?php echo $_SESSION['username']; ?></strong></a>
			<a href="logout.php">Logout</a></p>
		<?php endif ?>
		
		<div class="file_upload">
			<a href="history.php">History</a>
    		<a href="uploadfile.php">File Upload</a>
    		<a href="uploadURL.php">URL Upload</a>
    	</div>
	</div>
	<form action="/malware_detection/index.php">
		<button class="btn btn-default"> Back</button>
	</form>
</body>